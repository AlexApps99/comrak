Example 1 (lines 350-355) Tabs
	foo	baz		bim

--- expected HTML
+++ actual HTML
@@ -1,2 +1,2 @@
-<pre><code>foo	baz		bim
+<pre><code>    foo	baz		bim
 </code></pre>

Example 2 (lines 357-362) Tabs
  	foo	baz		bim

--- expected HTML
+++ actual HTML
@@ -1,2 +1,2 @@
-<pre><code>foo	baz		bim
+<pre><code>    foo	baz		bim
 </code></pre>

Example 4 (lines 377-388) Tabs
  - foo

	bar

--- expected HTML
+++ actual HTML
@@ -1,6 +1,7 @@
 <ul>
 <li>
 <p>foo</p>
-<p>bar</p>
+<pre><code>bar
+</code></pre>
 </li>
 </ul>

Example 5 (lines 390-402) Tabs
- foo

		bar

--- expected HTML
+++ actual HTML
@@ -1,7 +1,7 @@
 <ul>
 <li>
 <p>foo</p>
-<pre><code>  bar
+<pre><code>  	bar
 </code></pre>
 </li>
 </ul>

Example 6 (lines 413-420) Tabs
>		foo

--- expected HTML
+++ actual HTML
@@ -1,4 +1,4 @@
 <blockquote>
-<pre><code>  foo
+<pre><code>  	foo
 </code></pre>
 </blockquote>

Example 7 (lines 422-431) Tabs
-		foo

--- expected HTML
+++ actual HTML
@@ -1,6 +1,6 @@
 <ul>
 <li>
-<pre><code>  foo
+<pre><code>  	foo
 </code></pre>
 </li>
 </ul>

Example 8 (lines 434-441) Tabs
    foo
	bar

--- expected HTML
+++ actual HTML
@@ -1,3 +1,3 @@
 <pre><code>foo
-bar
+    bar
 </code></pre>

Example 9 (lines 443-459) Tabs
 - foo
   - bar
	 - baz

--- expected HTML
+++ actual HTML
@@ -2,10 +2,7 @@
 <li>foo
 <ul>
 <li>bar
-<ul>
-<li>baz</li>
+- baz</li>
 </ul>
 </li>
 </ul>
-</li>
-</ul>

Example 54 (lines 1063-1076) Setext headings
    Foo
    ---

    Foo
---

--- expected HTML
+++ actual HTML
@@ -3,4 +3,3 @@
 
 Foo
 </code></pre>
-<hr />

Example 69 (lines 1260-1267) Setext headings
    foo
---

--- expected HTML
+++ actual HTML
@@ -1,3 +1,2 @@
 <pre><code>foo
 </code></pre>
-<hr />

Example 79 (lines 1440-1451) Indented code blocks
    <a/>
    *hi*

    - one

--- expected HTML
+++ actual HTML
@@ -1,5 +1,4 @@
-<pre><code>&lt;a/&gt;
-*hi*
-
-- one
+    <a/>
+    *hi*
+<pre><code>- one
 </code></pre>

Example 83 (lines 1508-1515) Indented code blocks
    foo
bar

--- expected HTML
+++ actual HTML
@@ -1,3 +1,2 @@
 <pre><code>foo
 </code></pre>
-<p>bar</p>

Example 84 (lines 1521-1536) Indented code blocks
# Heading
    foo
Heading
------
    foo
----

--- expected HTML
+++ actual HTML
@@ -1,7 +1,6 @@
 <h1>Heading</h1>
 <pre><code>foo
 </code></pre>
-<h2>Heading</h2>
+<hr />
 <pre><code>foo
 </code></pre>
-<hr />

Example 111 (lines 1934-1945) Fenced code blocks
~~~~    ruby startline=3 $%@#$
def foo(x)
  return 3
end
~~~~~~~

--- expected HTML
+++ actual HTML
@@ -1,4 +1,4 @@
-<pre><code class="language-ruby">def foo(x)
+<pre><code class="language-ruby startline=3 $%@#$">def foo(x)
   return 3
 end
 </code></pre>

Example 149 (lines 2547-2555) HTML blocks
  <div>

    <div>

--- expected HTML
+++ actual HTML
@@ -1,3 +1,2 @@
   <div>
-<pre><code>&lt;div&gt;
-</code></pre>
+    <div>

Example 156 (lines 2695-2716) HTML blocks
<table>

  <tr>

    <td>
      Hi
    </td>

  </tr>

</table>

--- expected HTML
+++ actual HTML
@@ -1,8 +1,7 @@
 <table>
   <tr>
-<pre><code>&lt;td&gt;
-  Hi
-&lt;/td&gt;
-</code></pre>
+    <td>
+      Hi
+    </td>
   </tr>
 </table>

Example 157 (lines 2743-2749) Link reference definitions
[foo]: /url "title"

[foo]

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="/url" title="title">foo</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[foo]: /url &quot;title&quot;</p>
+<p>[foo]</p>

Example 158 (lines 2752-2760) Link reference definitions
   [foo]: 
      /url  
           'the title'  

[foo]

--- expected HTML
+++ actual HTML
@@ -1 +1,6 @@
-<p><a href="/url" title="the title">foo</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[foo]:
+/url<br />
+'the title'</p>
+<p>[foo]</p>

Example 159 (lines 2763-2769) Link reference definitions
[Foo*bar\]]:my_(url) 'title (with parens)'

[Foo*bar\]]

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="my_(url)" title="title (with parens)">Foo*bar]</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[Foo*bar]]:my_(url) 'title (with parens)'</p>
+<p>[Foo*bar]]</p>

Example 160 (lines 2772-2780) Link reference definitions
[Foo bar]:
<my%20url>
'title'

[Foo bar]

--- expected HTML
+++ actual HTML
@@ -1 +1,6 @@
-<p><a href="my%20url" title="title">Foo bar</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[Foo bar]:
+&lt;my%20url&gt;
+'title'</p>
+<p>[Foo bar]</p>

Example 161 (lines 2785-2799) Link reference definitions
[foo]: /url '
title
line1
line2
'

[foo]

--- expected HTML
+++ actual HTML
@@ -1,5 +1,8 @@
-<p><a href="/url" title="
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[foo]: /url '
 title
 line1
 line2
-">foo</a></p>
+'</p>
+<p>[foo]</p>

Example 162 (lines 2804-2814) Link reference definitions
[foo]: /url 'title

with blank line'

[foo]

--- expected HTML
+++ actual HTML
@@ -1,3 +1,5 @@
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
 <p>[foo]: /url 'title</p>
 <p>with blank line'</p>
 <p>[foo]</p>

Example 163 (lines 2819-2826) Link reference definitions
[foo]:
/url

[foo]

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/url">foo</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[foo]:
+/url</p>
+<p>[foo]</p>

Example 164 (lines 2831-2838) Link reference definitions
[foo]:

[foo]

--- expected HTML
+++ actual HTML
@@ -1,2 +1,4 @@
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
 <p>[foo]:</p>
 <p>[foo]</p>

Example 165 (lines 2844-2850) Link reference definitions
[foo]: /url\bar\*baz "foo\"bar\baz"

[foo]

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="/url%5Cbar*baz" title="foo&quot;bar\baz">foo</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[foo]: /url\bar*baz &quot;foo&quot;bar\baz&quot;</p>
+<p>[foo]</p>

Example 166 (lines 2855-2861) Link reference definitions
[foo]

[foo]: url

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="url">foo</a></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo]</p>
+<p>[foo]: url</p>

Example 167 (lines 2867-2874) Link reference definitions
[foo]

[foo]: first
[foo]: second

--- expected HTML
+++ actual HTML
@@ -1 +1,6 @@
-<p><a href="first">foo</a></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo]</p>
+<p>[foo]: first
+[foo]: second</p>

Example 168 (lines 2880-2886) Link reference definitions
[FOO]: /url

[Foo]

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="/url">Foo</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[FOO]: /url</p>
+<p>[Foo]</p>

Example 169 (lines 2889-2895) Link reference definitions
[ΑΓΩ]: /φου

[αγω]

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="/%CF%86%CE%BF%CF%85">αγω</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[ΑΓΩ]: /φου</p>
+<p>[αγω]</p>

Example 170 (lines 2901-2904) Link reference definitions
[foo]: /url

--- expected HTML
+++ actual HTML
@@ -0,0 +1,2 @@
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo]: /url</p>

Example 171 (lines 2909-2916) Link reference definitions
[
foo
]: /url
bar

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p>bar</p>
+peek char is Some(':'), sps is 0, n is 0
+<p>[
+foo
+]: /url
+bar</p>

Example 172 (lines 2922-2926) Link reference definitions
[foo]: /url "title" ok

--- expected HTML
+++ actual HTML
@@ -1 +1,2 @@
+peek char is Some(':'), sps is 0, n is 0
 <p>[foo]: /url &quot;title&quot; ok</p>

Example 173 (lines 2931-2936) Link reference definitions
[foo]: /url
"title" ok

--- expected HTML
+++ actual HTML
@@ -1 +1,3 @@
-<p>&quot;title&quot; ok</p>
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo]: /url
+&quot;title&quot; ok</p>

Example 174 (lines 2942-2950) Link reference definitions
    [foo]: /url "title"

[foo]

--- expected HTML
+++ actual HTML
@@ -1,3 +1,2 @@
 <pre><code>[foo]: /url &quot;title&quot;
 </code></pre>
-<p>[foo]</p>

Example 175 (lines 2956-2966) Link reference definitions
```
[foo]: /url
```

[foo]

--- expected HTML
+++ actual HTML
@@ -1,3 +1,4 @@
+peek char is None, sps is 0, n is 0
 <pre><code>[foo]: /url
 </code></pre>
 <p>[foo]</p>

Example 176 (lines 2971-2980) Link reference definitions
Foo
[bar]: /baz

[bar]

--- expected HTML
+++ actual HTML
@@ -1,3 +1,5 @@
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
 <p>Foo
 [bar]: /baz</p>
 <p>[bar]</p>

Example 177 (lines 2986-2995) Link reference definitions
# [Foo]
[foo]: /url
> bar

--- expected HTML
+++ actual HTML
@@ -1,4 +1,7 @@
-<h1><a href="/url">Foo</a></h1>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<h1>[Foo]</h1>
+<p>[foo]: /url</p>
 <blockquote>
 <p>bar</p>
 </blockquote>

Example 178 (lines 3001-3014) Link reference definitions
[foo]: /foo-url "foo"
[bar]: /bar-url
  "bar"
[baz]: /baz-url

[foo],
[bar],
[baz]

--- expected HTML
+++ actual HTML
@@ -1,3 +1,13 @@
-<p><a href="/foo-url" title="foo">foo</a>,
-<a href="/bar-url" title="bar">bar</a>,
-<a href="/baz-url">baz</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+peek char is Some(','), sps is 0, n is 0
+peek char is Some(','), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[foo]: /foo-url &quot;foo&quot;
+[bar]: /bar-url
+&quot;bar&quot;
+[baz]: /baz-url</p>
+<p>[foo],
+[bar],
+[baz]</p>

Example 179 (lines 3022-3030) Link reference definitions
[foo]

> [foo]: /url

--- expected HTML
+++ actual HTML
@@ -1,3 +1,6 @@
-<p><a href="/url">foo</a></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo]</p>
 <blockquote>
+<p>[foo]: /url</p>
 </blockquote>

Example 186 (lines 3121-3128) Paragraphs
    aaa
bbb

--- expected HTML
+++ actual HTML
@@ -1,3 +1,2 @@
 <pre><code>aaa
 </code></pre>
-<p>bbb</p>

Example 214 (lines 3650-3665) List items
A paragraph
with two lines.

    indented code

> A block quote.

--- expected HTML
+++ actual HTML
@@ -2,6 +2,3 @@
 with two lines.</p>
 <pre><code>indented code
 </code></pre>
-<blockquote>
-<p>A block quote.</p>
-</blockquote>

Example 215 (lines 3672-3691) List items
1.  A paragraph
    with two lines.

        indented code

    > A block quote.

--- expected HTML
+++ actual HTML
@@ -4,8 +4,5 @@
 with two lines.</p>
 <pre><code>indented code
 </code></pre>
-<blockquote>
-<p>A block quote.</p>
-</blockquote>
 </li>
 </ol>

Example 233 (lines 3990-4002) List items
    indented code

paragraph

    more code

--- expected HTML
+++ actual HTML
@@ -1,5 +1,4 @@
 <pre><code>indented code
 </code></pre>
-<p>paragraph</p>
 <pre><code>more code
 </code></pre>

Example 234 (lines 4005-4021) List items
1.     indented code

   paragraph

       more code

--- expected HTML
+++ actual HTML
@@ -2,7 +2,6 @@
 <li>
 <pre><code>indented code
 </code></pre>
-<p>paragraph</p>
 <pre><code>more code
 </code></pre>
 </li>

Example 235 (lines 4027-4043) List items
1.      indented code

   paragraph

       more code

--- expected HTML
+++ actual HTML
@@ -2,7 +2,6 @@
 <li>
 <pre><code> indented code
 </code></pre>
-<p>paragraph</p>
 <pre><code>more code
 </code></pre>
 </li>

Example 247 (lines 4240-4259) List items
 1.  A paragraph
     with two lines.

         indented code

     > A block quote.

--- expected HTML
+++ actual HTML
@@ -4,8 +4,5 @@
 with two lines.</p>
 <pre><code>indented code
 </code></pre>
-<blockquote>
-<p>A block quote.</p>
-</blockquote>
 </li>
 </ol>

Example 248 (lines 4264-4283) List items
  1.  A paragraph
      with two lines.

          indented code

      > A block quote.

--- expected HTML
+++ actual HTML
@@ -4,8 +4,5 @@
 with two lines.</p>
 <pre><code>indented code
 </code></pre>
-<blockquote>
-<p>A block quote.</p>
-</blockquote>
 </li>
 </ol>

Example 249 (lines 4288-4307) List items
   1.  A paragraph
       with two lines.

           indented code

       > A block quote.

--- expected HTML
+++ actual HTML
@@ -4,8 +4,5 @@
 with two lines.</p>
 <pre><code>indented code
 </code></pre>
-<blockquote>
-<p>A block quote.</p>
-</blockquote>
 </li>
 </ol>

Example 251 (lines 4342-4361) List items
  1.  A paragraph
with two lines.

          indented code

      > A block quote.

--- expected HTML
+++ actual HTML
@@ -4,8 +4,5 @@
 with two lines.</p>
 <pre><code>indented code
 </code></pre>
-<blockquote>
-<p>A block quote.</p>
-</blockquote>
 </li>
 </ol>

Example 276 (lines 5118-5136) Lists
- a
- b

  [ref]: /url
- d

--- expected HTML
+++ actual HTML
@@ -1,9 +1,11 @@
+peek char is Some(':'), sps is 0, n is 0
 <ul>
 <li>
 <p>a</p>
 </li>
 <li>
 <p>b</p>
+<p>[ref]: /url</p>
 </li>
 <li>
 <p>d</p>

Example 295 (lines 5434-5438) Backslash escapes
<http://example.com?find=\*>

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><a href="http://example.com?find=%5C*">http://example.com?find=\*</a></p>
+<p><a href="http://example.com?find=&#x5c;*">http://example.com?find=\*</a></p>

Example 298 (lines 5458-5464) Backslash escapes
[foo]

[foo]: /bar\* "ti\*tle"

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="/bar*" title="ti*tle">foo</a></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo]</p>
+<p>[foo]: /bar* &quot;ti*tle&quot;</p>

Example 307 (lines 5576-5580) Entity and numeric character references
[foo](/f&ouml;&ouml; "f&ouml;&ouml;")

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><a href="/f%C3%B6%C3%B6" title="föö">foo</a></p>
+<p><a href="/f&#xc3;&#xb6;&#xc3;&#xb6;" title="föö">foo</a></p>

Example 308 (lines 5583-5589) Entity and numeric character references
[foo]

[foo]: /f&ouml;&ouml; "f&ouml;&ouml;"

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="/f%C3%B6%C3%B6" title="föö">foo</a></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo]</p>
+<p>[foo]: /föö &quot;föö&quot;</p>

Example 325 (lines 5778-5782) Code spans
<http://foo.bar.`baz>`

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><a href="http://foo.bar.%60baz">http://foo.bar.`baz</a>`</p>
+<p><a href="http://foo.bar.&#x60;baz">http://foo.bar.`baz</a>`</p>

Example 331 (lines 6037-6041) Emphasis and strong emphasis
* a *

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p>* a *</p>
+<p><em> a </em></p>

Example 460 (lines 7220-7224) Links
[link](/my uri)

--- expected HTML
+++ actual HTML
@@ -1 +1,2 @@
+peek char is Some('('), sps is 0, n is 3
 <p>[link](/my uri)</p>

Example 461 (lines 7227-7231) Links
[link](</my uri>)

--- expected HTML
+++ actual HTML
@@ -1 +1,2 @@
+peek char is Some('('), sps is 0, n is 0
 <p>[link](&lt;/my uri&gt;)</p>

Example 462 (lines 7234-7240) Links
[link](foo
bar)

--- expected HTML
+++ actual HTML
@@ -1,2 +1,3 @@
+peek char is Some('('), sps is 0, n is 3
 <p>[link](foo
 bar)</p>

Example 463 (lines 7243-7249) Links
[link](<foo
bar>)

--- expected HTML
+++ actual HTML
@@ -1,2 +1,3 @@
+peek char is Some('('), sps is 0, n is 0
 <p>[link](<foo
 bar>)</p>

Example 470 (lines 7313-7317) Links
[link](foo\bar)

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><a href="foo%5Cbar">link</a></p>
+<p><a href="foo&#x5c;bar">link</a></p>

Example 471 (lines 7329-7333) Links
[link](foo%20b&auml;)

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><a href="foo%20b%C3%A4">link</a></p>
+<p><a href="foo%20b&#xc3;&#xa4;">link</a></p>

Example 472 (lines 7340-7344) Links
[link]("title")

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><a href="%22title%22">link</a></p>
+<p><a href="&#x22;title&#x22;">link</a></p>

Example 475 (lines 7373-7377) Links
[link](/url "title")

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><a href="/url%C2%A0%22title%22">link</a></p>
+<p><a href="/url&#xc2;&#xa0;&#x22;title&#x22;">link</a></p>

Example 476 (lines 7382-7386) Links
[link](/url "title "and" title")

--- expected HTML
+++ actual HTML
@@ -1 +1,2 @@
+peek char is Some('('), sps is 0, n is 4
 <p>[link](/url &quot;title &quot;and&quot; title&quot;)</p>

Example 479 (lines 7426-7430) Links
[link] (/uri)

--- expected HTML
+++ actual HTML
@@ -1 +1,2 @@
+peek char is Some(' '), sps is 0, n is 0
 <p>[link] (/uri)</p>

Example 480 (lines 7436-7440) Links
[link [foo [bar]]](/uri)

--- expected HTML
+++ actual HTML
@@ -1 +1,3 @@
+peek char is Some(']'), sps is 0, n is 0
+peek char is Some(']'), sps is 0, n is 0
 <p><a href="/uri">link [foo [bar]]</a></p>

Example 481 (lines 7443-7447) Links
[link] bar](/uri)

--- expected HTML
+++ actual HTML
@@ -1 +1,2 @@
+peek char is Some(' '), sps is 0, n is 0
 <p>[link] bar](/uri)</p>

Example 485 (lines 7473-7477) Links
[![moon](moon.jpg)](/uri)

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><a href="/uri"><img src="moon.jpg" alt="moon" /></a></p>
+<p><a href="/uri">!<a href="moon.jpg">moon</a></a></p>

Example 486 (lines 7482-7486) Links
[foo [bar](/uri)](/uri)

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p>[foo <a href="/uri">bar</a>](/uri)</p>
+<p><a href="/uri">foo <a href="/uri">bar</a></a></p>

Example 487 (lines 7489-7493) Links
[foo *[bar [baz](/uri)](/uri)*](/uri)

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p>[foo <em>[bar <a href="/uri">baz</a>](/uri)</em>](/uri)</p>
+<p><a href="/uri">foo <em><a href="/uri">bar <a href="/uri">baz</a></a></em></a></p>

Example 488 (lines 7496-7500) Links
![[[foo](uri1)](uri2)](uri3)

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><img src="uri3" alt="[foo](uri2)" /></p>
+<p>!<a href="uri3"><a href="uri2"><a href="uri1">foo</a></a></a></p>

Example 491 (lines 7523-7527) Links
*foo [bar* baz]

--- expected HTML
+++ actual HTML
@@ -1 +1,2 @@
+peek char is None, sps is 0, n is 0
 <p><em>foo [bar</em> baz]</p>

Example 494 (lines 7547-7551) Links
[foo<http://example.com/?search=](uri)>

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p>[foo<a href="http://example.com/?search=%5D(uri)">http://example.com/?search=](uri)</a></p>
+<p>[foo<a href="http://example.com/?search=&#x5d;(uri)">http://example.com/?search=](uri)</a></p>

Example 495 (lines 7582-7588) Links
[foo][bar]

[bar]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/url" title="title">foo</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo][bar]</p>
+<p>[bar]: /url &quot;title&quot;</p>

Example 496 (lines 7597-7603) Links
[link [foo [bar]]][ref]

[ref]: /uri

--- expected HTML
+++ actual HTML
@@ -1 +1,7 @@
-<p><a href="/uri">link [foo [bar]]</a></p>
+peek char is Some(']'), sps is 0, n is 0
+peek char is Some(']'), sps is 0, n is 0
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[link [foo [bar]]][ref]</p>
+<p>[ref]: /uri</p>

Example 497 (lines 7606-7612) Links
[link \[bar][ref]

[ref]: /uri

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/uri">link [bar</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[link [bar][ref]</p>
+<p>[ref]: /uri</p>

Example 498 (lines 7617-7623) Links
[link *foo **bar** `#`*][ref]

[ref]: /uri

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/uri">link <em>foo <strong>bar</strong> <code>#</code></em></a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[link <em>foo <strong>bar</strong> <code>#</code></em>][ref]</p>
+<p>[ref]: /uri</p>

Example 499 (lines 7626-7632) Links
[![moon](moon.jpg)][ref]

[ref]: /uri

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/uri"><img src="moon.jpg" alt="moon" /></a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[!<a href="moon.jpg">moon</a>][ref]</p>
+<p>[ref]: /uri</p>

Example 500 (lines 7637-7643) Links
[foo [bar](/uri)][ref]

[ref]: /uri

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p>[foo <a href="/uri">bar</a>]<a href="/uri">ref</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo <a href="/uri">bar</a>][ref]</p>
+<p>[ref]: /uri</p>

Example 501 (lines 7646-7652) Links
[foo *bar [baz][ref]*][ref]

[ref]: /uri

--- expected HTML
+++ actual HTML
@@ -1 +1,7 @@
-<p>[foo <em>bar <a href="/uri">baz</a></em>]<a href="/uri">ref</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is Some('*'), sps is 0, n is 0
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo <em>bar [baz][ref]</em>][ref]</p>
+<p>[ref]: /uri</p>

Example 502 (lines 7661-7667) Links
*[foo*][ref]

[ref]: /uri

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p>*<a href="/uri">foo*</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p><em>[foo</em>][ref]</p>
+<p>[ref]: /uri</p>

Example 503 (lines 7670-7676) Links
[foo *bar][ref]

[ref]: /uri

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/uri">foo *bar</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo *bar][ref]</p>
+<p>[ref]: /uri</p>

Example 504 (lines 7682-7688) Links
[foo <bar attr="][ref]">

[ref]: /uri

--- expected HTML
+++ actual HTML
@@ -1 +1,3 @@
+peek char is Some(':'), sps is 0, n is 0
 <p>[foo <bar attr="][ref]"></p>
+<p>[ref]: /uri</p>

Example 505 (lines 7691-7697) Links
[foo`][ref]`

[ref]: /uri

--- expected HTML
+++ actual HTML
@@ -1 +1,3 @@
+peek char is Some(':'), sps is 0, n is 0
 <p>[foo<code>][ref]</code></p>
+<p>[ref]: /uri</p>

Example 506 (lines 7700-7706) Links
[foo<http://example.com/?search=][ref]>

[ref]: /uri

--- expected HTML
+++ actual HTML
@@ -1 +1,3 @@
-<p>[foo<a href="http://example.com/?search=%5D%5Bref%5D">http://example.com/?search=][ref]</a></p>
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo<a href="http://example.com/?search=&#x5d;&#x5b;ref&#x5d;">http://example.com/?search=][ref]</a></p>
+<p>[ref]: /uri</p>

Example 507 (lines 7711-7717) Links
[foo][BaR]

[bar]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/url" title="title">foo</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo][BaR]</p>
+<p>[bar]: /url &quot;title&quot;</p>

Example 508 (lines 7722-7728) Links
[Толпой][Толпой] is a Russian word.

[ТОЛПОЙ]: /url

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/url">Толпой</a> is a Russian word.</p>
+peek char is Some('['), sps is 0, n is 0
+peek char is Some(' '), sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[Толпой][Толпой] is a Russian word.</p>
+<p>[ТОЛПОЙ]: /url</p>

Example 509 (lines 7734-7741) Links
[Foo
  bar]: /url

[Baz][Foo bar]

--- expected HTML
+++ actual HTML
@@ -1 +1,6 @@
-<p><a href="/url">Baz</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[Foo
+bar]: /url</p>
+<p>[Baz][Foo bar]</p>

Example 510 (lines 7747-7753) Links
[foo] [bar]

[bar]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p>[foo] <a href="/url" title="title">bar</a></p>
+peek char is Some(' '), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo] [bar]</p>
+<p>[bar]: /url &quot;title&quot;</p>

Example 511 (lines 7756-7764) Links
[foo]
[bar]

[bar]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1,2 +1,6 @@
+peek char is Some('\n'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
 <p>[foo]
-<a href="/url" title="title">bar</a></p>
+[bar]</p>
+<p>[bar]: /url &quot;title&quot;</p>

Example 512 (lines 7797-7805) Links
[foo]: /url1

[foo]: /url2

[bar][foo]

--- expected HTML
+++ actual HTML
@@ -1 +1,7 @@
-<p><a href="/url1">bar</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[foo]: /url1</p>
+<p>[foo]: /url2</p>
+<p>[bar][foo]</p>

Example 513 (lines 7812-7818) Links
[bar][foo\!]

[foo!]: /url

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
 <p>[bar][foo!]</p>
+<p>[foo!]: /url</p>

Example 514 (lines 7824-7831) Links
[foo][ref[]

[ref[]: /uri

--- expected HTML
+++ actual HTML
@@ -1,2 +1,5 @@
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
 <p>[foo][ref[]</p>
 <p>[ref[]: /uri</p>

Example 515 (lines 7834-7841) Links
[foo][ref[bar]]

[ref[bar]]: /uri

--- expected HTML
+++ actual HTML
@@ -1,2 +1,7 @@
+peek char is Some('['), sps is 0, n is 0
+peek char is Some(']'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(']'), sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
 <p>[foo][ref[bar]]</p>
 <p>[ref[bar]]: /uri</p>

Example 516 (lines 7844-7851) Links
[[[foo]]]

[[[foo]]]: /url

--- expected HTML
+++ actual HTML
@@ -1,2 +1,8 @@
+peek char is Some(']'), sps is 0, n is 0
+peek char is Some(']'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(']'), sps is 0, n is 0
+peek char is Some(']'), sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
 <p>[[[foo]]]</p>
 <p>[[[foo]]]: /url</p>

Example 517 (lines 7854-7860) Links
[foo][ref\[]

[ref\[]: /uri

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/uri">foo</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo][ref[]</p>
+<p>[ref[]: /uri</p>

Example 518 (lines 7865-7871) Links
[bar\\]: /uri

[bar\\]

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="/uri">bar\</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[bar\]: /uri</p>
+<p>[bar\]</p>

Example 519 (lines 7876-7883) Links
[]

[]: /uri

--- expected HTML
+++ actual HTML
@@ -1,2 +1,4 @@
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
 <p>[]</p>
 <p>[]: /uri</p>

Example 520 (lines 7886-7897) Links
[
 ]

[
 ]: /uri

--- expected HTML
+++ actual HTML
@@ -1,3 +1,5 @@
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
 <p>[
 ]</p>
 <p>[

Example 521 (lines 7909-7915) Links
[foo][]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/url" title="title">foo</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo][]</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 522 (lines 7918-7924) Links
[*foo* bar][]

[*foo* bar]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/url" title="title"><em>foo</em> bar</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[<em>foo</em> bar][]</p>
+<p>[<em>foo</em> bar]: /url &quot;title&quot;</p>

Example 523 (lines 7929-7935) Links
[Foo][]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/url" title="title">Foo</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[Foo][]</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 524 (lines 7942-7950) Links
[foo] 
[]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1,2 +1,6 @@
-<p><a href="/url" title="title">foo</a>
+peek char is Some(' '), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo]
 []</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 525 (lines 7962-7968) Links
[foo]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="/url" title="title">foo</a></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo]</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 526 (lines 7971-7977) Links
[*foo* bar]

[*foo* bar]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="/url" title="title"><em>foo</em> bar</a></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[<em>foo</em> bar]</p>
+<p>[<em>foo</em> bar]: /url &quot;title&quot;</p>

Example 527 (lines 7980-7986) Links
[[*foo* bar]]

[*foo* bar]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p>[<a href="/url" title="title"><em>foo</em> bar</a>]</p>
+peek char is Some(']'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[[<em>foo</em> bar]]</p>
+<p>[<em>foo</em> bar]: /url &quot;title&quot;</p>

Example 528 (lines 7989-7995) Links
[[bar [foo]

[foo]: /url

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p>[[bar <a href="/url">foo</a></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[[bar [foo]</p>
+<p>[foo]: /url</p>

Example 529 (lines 8000-8006) Links
[Foo]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="/url" title="title">Foo</a></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[Foo]</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 530 (lines 8011-8017) Links
[foo] bar

[foo]: /url

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="/url">foo</a> bar</p>
+peek char is Some(' '), sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo] bar</p>
+<p>[foo]: /url</p>

Example 531 (lines 8023-8029) Links
\[foo]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,3 @@
+peek char is Some(':'), sps is 0, n is 0
 <p>[foo]</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 532 (lines 8035-8041) Links
[foo*]: /url

*[foo*]

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p>*<a href="/url">foo*</a></p>
+peek char is Some(':'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+<p>[foo*]: /url</p>
+<p><em>[foo</em>]</p>

Example 533 (lines 8047-8054) Links
[foo][bar]

[foo]: /url1
[bar]: /url2

--- expected HTML
+++ actual HTML
@@ -1 +1,7 @@
-<p><a href="/url2">foo</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo][bar]</p>
+<p>[foo]: /url1
+[bar]: /url2</p>

Example 534 (lines 8056-8062) Links
[foo][]

[foo]: /url1

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><a href="/url1">foo</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo][]</p>
+<p>[foo]: /url1</p>

Example 535 (lines 8066-8072) Links
[foo]()

[foo]: /url1

--- expected HTML
+++ actual HTML
@@ -1 +1,3 @@
+peek char is Some(':'), sps is 0, n is 0
 <p><a href="">foo</a></p>
+<p>[foo]: /url1</p>

Example 536 (lines 8074-8080) Links
[foo](not a link)

[foo]: /url1

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><a href="/url1">foo</a>(not a link)</p>
+peek char is Some('('), sps is 0, n is 3
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo](not a link)</p>
+<p>[foo]: /url1</p>

Example 537 (lines 8085-8091) Links
[foo][bar][baz]

[baz]: /url

--- expected HTML
+++ actual HTML
@@ -1 +1,6 @@
-<p>[foo]<a href="/url">bar</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo][bar][baz]</p>
+<p>[baz]: /url</p>

Example 538 (lines 8097-8104) Links
[foo][bar][baz]

[baz]: /url1
[bar]: /url2

--- expected HTML
+++ actual HTML
@@ -1 +1,8 @@
-<p><a href="/url2">foo</a><a href="/url1">baz</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo][bar][baz]</p>
+<p>[baz]: /url1
+[bar]: /url2</p>

Example 539 (lines 8110-8117) Links
[foo][bar][baz]

[baz]: /url1
[foo]: /url2

--- expected HTML
+++ actual HTML
@@ -1 +1,8 @@
-<p>[foo]<a href="/url1">bar</a></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>[foo][bar][baz]</p>
+<p>[baz]: /url1
+[foo]: /url2</p>

Example 540 (lines 8133-8137) Images
![foo](/url "title")

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><img src="/url" alt="foo" title="title" /></p>
+<p>!<a href="/url" title="title">foo</a></p>

Example 541 (lines 8140-8146) Images
![foo *bar*]

[foo *bar*]: train.jpg "train & tracks"

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><img src="train.jpg" alt="foo bar" title="train &amp; tracks" /></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![foo <em>bar</em>]</p>
+<p>[foo <em>bar</em>]: train.jpg &quot;train &amp; tracks&quot;</p>

Example 542 (lines 8149-8153) Images
![foo ![bar](/url)](/url2)

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><img src="/url2" alt="foo bar" /></p>
+<p>!<a href="/url2">foo !<a href="/url">bar</a></a></p>

Example 543 (lines 8156-8160) Images
![foo [bar](/url)](/url2)

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><img src="/url2" alt="foo bar" /></p>
+<p>!<a href="/url2">foo <a href="/url">bar</a></a></p>

Example 544 (lines 8170-8176) Images
![foo *bar*][]

[foo *bar*]: train.jpg "train & tracks"

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><img src="train.jpg" alt="foo bar" title="train &amp; tracks" /></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![foo <em>bar</em>][]</p>
+<p>[foo <em>bar</em>]: train.jpg &quot;train &amp; tracks&quot;</p>

Example 545 (lines 8179-8185) Images
![foo *bar*][foobar]

[FOOBAR]: train.jpg "train & tracks"

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><img src="train.jpg" alt="foo bar" title="train &amp; tracks" /></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![foo <em>bar</em>][foobar]</p>
+<p>[FOOBAR]: train.jpg &quot;train &amp; tracks&quot;</p>

Example 546 (lines 8188-8192) Images
![foo](train.jpg)

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><img src="train.jpg" alt="foo" /></p>
+<p>!<a href="train.jpg">foo</a></p>

Example 547 (lines 8195-8199) Images
My ![foo bar](/path/to/train.jpg  "title"   )

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p>My <img src="/path/to/train.jpg" alt="foo bar" title="title" /></p>
+<p>My !<a href="/path/to/train.jpg" title="title">foo bar</a></p>

Example 548 (lines 8202-8206) Images
![foo](<url>)

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><img src="url" alt="foo" /></p>
+<p>!<a href="url">foo</a></p>

Example 549 (lines 8209-8213) Images
![](/url)

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><img src="/url" alt="" /></p>
+<p>!<a href="/url"></a></p>

Example 550 (lines 8218-8224) Images
![foo][bar]

[bar]: /url

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><img src="/url" alt="foo" /></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![foo][bar]</p>
+<p>[bar]: /url</p>

Example 551 (lines 8227-8233) Images
![foo][bar]

[BAR]: /url

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><img src="/url" alt="foo" /></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![foo][bar]</p>
+<p>[BAR]: /url</p>

Example 552 (lines 8238-8244) Images
![foo][]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><img src="/url" alt="foo" title="title" /></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![foo][]</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 553 (lines 8247-8253) Images
![*foo* bar][]

[*foo* bar]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><img src="/url" alt="foo bar" title="title" /></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![<em>foo</em> bar][]</p>
+<p>[<em>foo</em> bar]: /url &quot;title&quot;</p>

Example 554 (lines 8258-8264) Images
![Foo][]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,5 @@
-<p><img src="/url" alt="Foo" title="title" /></p>
+peek char is Some('['), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![Foo][]</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 555 (lines 8270-8278) Images
![foo] 
[]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1,2 +1,6 @@
-<p><img src="/url" alt="foo" title="title" />
+peek char is Some(' '), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![foo]
 []</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 556 (lines 8283-8289) Images
![foo]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><img src="/url" alt="foo" title="title" /></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![foo]</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 557 (lines 8292-8298) Images
![*foo* bar]

[*foo* bar]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><img src="/url" alt="foo bar" title="title" /></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![<em>foo</em> bar]</p>
+<p>[<em>foo</em> bar]: /url &quot;title&quot;</p>

Example 558 (lines 8303-8310) Images
![[foo]]

[[foo]]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1,2 +1,6 @@
+peek char is Some(']'), sps is 0, n is 0
+peek char is None, sps is 0, n is 0
+peek char is Some(']'), sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
 <p>![[foo]]</p>
 <p>[[foo]]: /url &quot;title&quot;</p>

Example 559 (lines 8315-8321) Images
![Foo]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p><img src="/url" alt="Foo" title="title" /></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![Foo]</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 560 (lines 8327-8333) Images
!\[foo]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,3 @@
+peek char is Some(':'), sps is 0, n is 0
 <p>![foo]</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 561 (lines 8339-8345) Images
\![foo]

[foo]: /url "title"

--- expected HTML
+++ actual HTML
@@ -1 +1,4 @@
-<p>!<a href="/url" title="title">foo</a></p>
+peek char is None, sps is 0, n is 0
+peek char is Some(':'), sps is 0, n is 0
+<p>![foo]</p>
+<p>[foo]: /url &quot;title&quot;</p>

Example 571 (lines 8446-8450) Autolinks
<http://example.com/\[\>

--- expected HTML
+++ actual HTML
@@ -1 +1 @@
-<p><a href="http://example.com/%5C%5B%5C">http://example.com/\[\</a></p>
+<p><a href="http://example.com/&#x5c;&#x5b;&#x5c;">http://example.com/\[\</a></p>

479 passed, 142 failed, 0 errored, 0 skipped
